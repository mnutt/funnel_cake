
remove_old_rows = <<HERE
  var lastRow = $$('tr.funnel_event').last();
  for(i=0; i<#{@events.count}; i++) {
    var oldLastRow = lastRow;
    lastRow = oldLastRow.previousSiblings().first();
    oldLastRow.fade({duration: 0.5, afterFinish: function(e){ $(e.element.id).remove() }});
  }
HERE

page << remove_old_rows

page.insert_html :after, 'events_header', :partial => 'event', :collection=>@funnel_events
